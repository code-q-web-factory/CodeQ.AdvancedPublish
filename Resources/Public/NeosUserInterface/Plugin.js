(()=>{var ge=Object.create;var k=Object.defineProperty;var z=Object.getOwnPropertyDescriptor;var _e=Object.getOwnPropertyNames;var De=Object.getPrototypeOf,we=Object.prototype.hasOwnProperty;var Ce=(e,o)=>()=>(e&&(o=e(e=0)),o);var m=(e,o)=>()=>(o||e((o={exports:{}}).exports,o),o.exports);var Pe=(e,o,r,t)=>{if(o&&typeof o=="object"||typeof o=="function")for(let s of _e(o))!we.call(e,s)&&s!==r&&k(e,s,{get:()=>o[s],enumerable:!(t=z(o,s))||t.enumerable});return e};var d=(e,o,r)=>(r=e!=null?ge(De(e)):{},Pe(o||!e||!e.__esModule?k(r,"default",{value:e,enumerable:!0}):r,e));var Y=(e,o,r,t)=>{for(var s=t>1?void 0:t?z(o,r):o,a=e.length-1,c;a>=0;a--)(c=e[a])&&(s=(t?c(o,r,s):c(s))||s);return t&&s&&k(o,r,s),s};function n(e){return(...o)=>{if(window["@Neos:HostPluginAPI"]&&window["@Neos:HostPluginAPI"][`@${e}`])return window["@Neos:HostPluginAPI"][`@${e}`](...o);throw new Error("You are trying to read from a consumer api that hasn't been initialized yet!")}}var p=Ce(()=>{});var R=m((eo,T)=>{p();T.exports=n("vendor")().ReactDOM});var y=m((so,j)=>{p();j.exports=n("vendor")().React});var K=m((io,V)=>{p();V.exports=n("vendor")().reduxSagaEffects});var O=m((no,Q)=>{p();Q.exports=n("NeosProjectPackages")().NeosUiReduxStore});var $=m((lo,J)=>{p();J.exports=n("vendor")().reduxActions});var E=m((uo,oe)=>{p();oe.exports=n("vendor")().reactRedux});var H=m((bo,se)=>{p();se.exports=n("vendor")().PropTypes});var I=m((fo,re)=>{p();re.exports=n("vendor")().classnames});var te=m((_o,ie)=>{p();ie.exports=n("NeosProjectPackages")().ReactUiComponents});var ae=m((wo,ne)=>{p();ne.exports=n("NeosProjectPackages")().NeosUiI18n});var le=m((Po,de)=>{p();de.exports=n("NeosProjectPackages")().NeosUiDecorators});p();var G=n("manifest");var be=d(R()),D=d(y()),w=d(K()),U=d(O());var x=d($()),X={TOGGLE_ADVANCED_PUBLISH_DIALOG:"CodeQ.AdvancedPublish/TOGGLE_ADVANCED_PUBLISH_DIALOG"},Ne=(0,x.createAction)(X.TOGGLE_ADVANCED_PUBLISH_DIALOG),S={toggleAdvancedPublishDialog:Ne},Z=(0,x.handleActions)({[X.TOGGLE_ADVANCED_PUBLISH_DIALOG]:(e,o)=>({...e,plugins:{...e.plugins,advancedPublishDialog:{open:o.payload!==void 0?o.payload.open:!e.plugins?.advancedPublishDialog?.open}}})},{plugins:{advancedPublishDialog:{open:!1}}}),ee={advancedPublishDialogOpen:e=>e.plugins?.advancedPublishDialog?.open};var W=d(E());var i=d(y()),b=d(H()),pe=d(E()),ue=d(I()),u=d(te()),_=d(ae()),P=d(O()),me=d(le());var v=d(y()),g=d(H()),ce=d(I());var C={btn:"codeq-6V4iJG_btn","btn--notAllowed":"codeq-6V4iJG_btn--notAllowed","btn--highlighted":"codeq-6V4iJG_btn--highlighted","btn--disabled":"codeq-6V4iJG_btn--disabled"};var h=class extends v.PureComponent{render(){let{isEnabled:o,isHighlighted:r,className:t,...s}=this.props,a=(0,ce.default)({[C.btn]:!0,[C["btn--disabled"]]:!o,[C["btn--notAllowed"]]:!o,[C["btn--highlighted"]]:r,[t]:t&&t.length});return v.default.createElement("button",{className:a,...{disabled:!o},...s},this.props.children)}};h.propTypes={isEnabled:g.default.bool,isHighlighted:g.default.bool,className:g.default.string,label:g.default.string,children:g.default.node.isRequired,onClick:g.default.func.isRequired};var l={dropDown__iconWrapper:"codeq-zYCUHW_dropDown__iconWrapper",dropDown__item:"codeq-zYCUHW_dropDown__item",dropdownOptionCheckbox__input:"codeq-zYCUHW_dropdownOptionCheckbox__input",wrapper:"codeq-zYCUHW_wrapper",dropDown:"codeq-zYCUHW_dropDown","dropDown__item--noHover":"codeq-zYCUHW_dropDown__item--noHover","dropDown__item--isPublishing":"codeq-zYCUHW_dropDown__item--isPublishing",dropDown__btn:"codeq-zYCUHW_dropDown__btn","dropDown__item--canPublish":"codeq-zYCUHW_dropDown__item--canPublish",dropDown__contents:"codeq-zYCUHW_dropDown__contents","dropDown__item--isSaving":"codeq-zYCUHW_dropDown__item--isSaving",dropdownOptionCheckbox__label:"codeq-zYCUHW_dropdownOptionCheckbox__label",dropdownOptionCheckbox:"codeq-zYCUHW_dropdownOptionCheckbox",badge:"codeq-zYCUHW_badge",publishBtn:"codeq-zYCUHW_publishBtn","dropDown__item--disabled":"codeq-zYCUHW_dropDown__item--disabled","dropDown__item--isDiscarding":"codeq-zYCUHW_dropDown__item--isDiscarding"};var{publishableNodesSelector:ye,publishableNodesInDocumentSelector:xe,baseWorkspaceSelector:ve,isWorkspaceReadOnlySelector:We}=P.selectors.CR.Workspaces,f=class extends i.PureComponent{constructor(){super(...arguments);this.handlePublishAllClick=()=>{let{publishableNodes:r,publishAction:t,baseWorkspace:s}=this.props;t(r.map(a=>a?.contextPath),s)};this.handleDiscardClick=()=>{let{publishableNodesInDocument:r,discardAction:t}=this.props;t(r.map(s=>s?.contextPath))};this.handleDiscardAllClick=()=>{let{publishableNodes:r,discardAction:t}=this.props;t(r.map(s=>s?.contextPath))}}render(){let{publishableNodes:r,publishableNodesInDocument:t,isSaving:s,isPublishing:a,isDiscarding:c,isWorkspaceReadOnly:q,i18nRegistry:L}=this.props,he=!s&&!a&&!c&&t&&t.length>0,A=!s&&!a&&!c&&r&&r.length>0,fe=this.getTranslatedMainButton(),F=(0,ue.default)({[l.dropDown__btn]:!0,[l["dropDown__item--canPublish"]]:A,[l["dropDown__item--isPublishing"]]:a,[l["dropDown__item--isSaving"]]:s,[l["dropDown__item--isDiscarding"]]:c}),M=t?t.length:0,N=r?r.length:0;return i.default.createElement("div",{id:"neos-PublishDropDown",className:l.wrapper},i.default.createElement(h,{id:"neos-PublishDropDown-Publish",className:l.publishBtn,isEnabled:!q&&A,isHighlighted:A||s||a,onClick:this.handlePublishAllClick},fe," ",q?i.default.createElement(u.Icon,{icon:"lock"}):"",N>0&&i.default.createElement(u.Badge,{className:l.badge,label:String(N)})),i.default.createElement(u.DropDown,{className:l.dropDown},a||s||c?i.default.createElement(u.DropDown.Header,{iconIsOpen:"spinner",iconIsClosed:"spinner",iconRest:{spin:!0,transform:"up-8"},className:F,disabled:!0,"aria-label":L.translate("Neos.Neos:Main:showPublishOptions","Show publishing options")}):i.default.createElement(u.DropDown.Header,{className:F,"aria-label":L.translate("Neos.Neos:Main:showPublishOptions","Show publishing options")}),i.default.createElement(u.DropDown.Contents,{className:l.dropDown__contents},i.default.createElement("li",{className:l.dropDown__item},i.default.createElement(h,{id:"neos-PublishDropDown-Discard",isEnabled:he,isHighlighted:!1,label:"Discard",icon:"ban",onClick:this.handleDiscardClick},i.default.createElement("div",{className:l.dropDown__iconWrapper},i.default.createElement(u.Icon,{icon:"ban"})),i.default.createElement(_.default,{id:"Neos.Neos:Main:discard",fallback:"Discard"}),M>0&&i.default.createElement(u.Badge,{className:l.badge,label:String(M)}))),i.default.createElement("li",{className:l.dropDown__item},i.default.createElement(h,{id:"neos-PublishDropDown-DiscardAll",isEnabled:A,isHighlighted:!1,onClick:this.handleDiscardAllClick},i.default.createElement("div",{className:l.dropDown__iconWrapper},i.default.createElement(u.Icon,{icon:"ban"})),i.default.createElement(_.default,{id:"Neos.Neos:Main:discardAll",fallback:"Discard All"}),N>0&&i.default.createElement(u.Badge,{className:l.badge,label:String(N)}))))))}getTranslatedMainButton(){let{publishableNodes:r,isSaving:t,isPublishing:s,isDiscarding:a}=this.props,c=r&&r.length>0;return t?i.default.createElement(_.default,{id:"Neos.Neos:Main:saving",fallback:"saving"}):s?i.default.createElement(_.default,{id:"Neos.Neos:Main:publishTo",fallback:"Publish to",params:{0:"..."}}):a?"Discarding...":c?i.default.createElement(_.default,{id:"Neos.Neos:Main:publishAll",fallback:"Publish All"}):i.default.createElement(i.Fragment,null,i.default.createElement(_.default,{id:"Neos.Neos:Main:published",fallback:"Published"}))}};f.propTypes={isSaving:b.default.bool,isPublishing:b.default.bool,isDiscarding:b.default.bool,isWorkspaceReadOnly:b.default.bool,publishableNodes:b.default.array,publishableNodesInDocument:b.default.array,baseWorkspace:b.default.string.isRequired,publishAction:b.default.func.isRequired,discardAction:b.default.func.isRequired,i18nRegistry:b.default.object.isRequired},f=Y([(0,pe.connect)(e=>({isSaving:e?.ui?.remote?.isSaving,isPublishing:e?.ui?.remote?.isPublishing,isDiscarding:e?.ui?.remote?.isDiscarding,publishableNodes:ye(e),publishableNodesInDocument:xe(e),baseWorkspace:ve(e),isWorkspaceReadOnly:We(e)}),{publishAction:P.actions.CR.Workspaces.publish,discardAction:P.actions.CR.Workspaces.commenceDiscard}),(0,me.neos)(e=>({i18nRegistry:e.get("i18n")}))],f);var ke=({iframeUri:e})=>{let o=(0,W.useSelector)(ee.advancedPublishDialogOpen),r=D.useRef(null),t=(0,W.useDispatch)(),s=D.useCallback(()=>{r.current?.contentWindow&&window.addEventListener("message",c=>{c.data==="closePublicationPopup"&&t(S.toggleAdvancedPublishDialog({open:!1}))})},[]);return o?D.createElement("iframe",{ref:r,onLoad:s,style:{width:"100%",height:"100%",position:"absolute",zIndex:"999999",top:"0",background:"#000",border:"0"},src:e}):""};G("CodeQ.AdvancedPublish",{},(e,{frontendConfiguration:o})=>{let r=o["CodeQ.AdvancedPublish"];if(!r.enabled||r.isSuperEditor===!0)return;function*t(){yield(0,w.takeLatest)(U.actionTypes.CR.Workspaces.PUBLISH,function*(){let{payload:s}=yield(0,w.take)(U.actionTypes.ServerFeedback.HANDLE_SERVER_FEEDBACK);if(!s.feedbackEnvelope.feedbacks.some(a=>a.type==="Neos.Neos.Ui:Success")){console.warn("CodeQ.AdvancedPublish :: Publishing doesnt seem to have been successful. Aborting.");return}yield(0,w.put)(S.toggleAdvancedPublishDialog())})}e.get("containers").set("Modals/CodeQ.AdvancedPublish",()=>be.createPortal(D.createElement(ke,{iframeUri:r.iframeUri}),document.body)),e.get("sagas").set("CodeQ.AdvancedPublish/afterPublish",{saga:t}),e.get("reducers").set("CodeQ.AdvancedPublish",{reducer:Z}),e.get("containers").set("PrimaryToolbar/Right/PublishDropDown",f)});})();
//# sourceMappingURL=Plugin.js.map

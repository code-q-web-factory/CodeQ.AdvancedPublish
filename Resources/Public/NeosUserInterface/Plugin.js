(()=>{var ge=Object.create;var k=Object.defineProperty;var z=Object.getOwnPropertyDescriptor;var _e=Object.getOwnPropertyNames;var De=Object.getPrototypeOf,we=Object.prototype.hasOwnProperty;var Ce=(e,o)=>()=>(e&&(o=e(e=0)),o);var m=(e,o)=>()=>(o||e((o={exports:{}}).exports,o),o.exports);var Pe=(e,o,r,t)=>{if(o&&typeof o=="object"||typeof o=="function")for(let s of _e(o))!we.call(e,s)&&s!==r&&k(e,s,{get:()=>o[s],enumerable:!(t=z(o,s))||t.enumerable});return e};var a=(e,o,r)=>(r=e!=null?ge(De(e)):{},Pe(o||!e||!e.__esModule?k(r,"default",{value:e,enumerable:!0}):r,e));var Y=(e,o,r,t)=>{for(var s=t>1?void 0:t?z(o,r):o,l=e.length-1,c;l>=0;l--)(c=e[l])&&(s=(t?c(o,r,s):c(s))||s);return t&&s&&k(o,r,s),s};function n(e){return(...o)=>{if(window["@Neos:HostPluginAPI"]&&window["@Neos:HostPluginAPI"][`@${e}`])return window["@Neos:HostPluginAPI"][`@${e}`](...o);throw new Error("You are trying to read from a consumer api that hasn't been initialized yet!")}}var p=Ce(()=>{});var R=m((eo,T)=>{p();T.exports=n("vendor")().ReactDOM});var y=m((so,j)=>{p();j.exports=n("vendor")().React});var K=m((io,V)=>{p();V.exports=n("vendor")().reduxSagaEffects});var O=m((no,Q)=>{p();Q.exports=n("NeosProjectPackages")().NeosUiReduxStore});var $=m((lo,J)=>{p();J.exports=n("vendor")().reduxActions});var E=m((uo,oe)=>{p();oe.exports=n("vendor")().reactRedux});var H=m((ho,se)=>{p();se.exports=n("vendor")().PropTypes});var I=m((fo,re)=>{p();re.exports=n("vendor")().classnames});var te=m((_o,ie)=>{p();ie.exports=n("NeosProjectPackages")().ReactUiComponents});var ae=m((wo,ne)=>{p();ne.exports=n("NeosProjectPackages")().NeosUiI18n});var le=m((Po,de)=>{p();de.exports=n("NeosProjectPackages")().NeosUiDecorators});p();var G=n("manifest");var he=a(R()),D=a(y()),w=a(K()),U=a(O());var v=a($()),X={TOGGLE_ADVANCED_PUBLISH_DIALOG:"CodeQ.AdvancedPublish/TOGGLE_ADVANCED_PUBLISH_DIALOG"},Ne=(0,v.createAction)(X.TOGGLE_ADVANCED_PUBLISH_DIALOG),S={toggleAdvancedPublishDialog:Ne},Z=(0,v.handleActions)({[X.TOGGLE_ADVANCED_PUBLISH_DIALOG]:(e,o)=>({...e,plugins:{...e.plugins,advancedPublishDialog:{open:o.payload!==void 0?o.payload.open:!e.plugins?.advancedPublishDialog?.open}}})},{plugins:{advancedPublishDialog:{open:!1}}}),ee={advancedPublishDialogOpen:e=>e.plugins?.advancedPublishDialog?.open};var W=a(E());var i=a(y()),h=a(H()),pe=a(E()),ue=a(I()),u=a(te()),_=a(ae()),P=a(O()),me=a(le());var x=a(y()),g=a(H()),ce=a(I());var C={"btn--disabled":"codeq-6V4iJG_btn--disabled","btn--highlighted":"codeq-6V4iJG_btn--highlighted","btn--notAllowed":"codeq-6V4iJG_btn--notAllowed",btn:"codeq-6V4iJG_btn"};var b=class extends x.PureComponent{render(){let{isEnabled:o,isHighlighted:r,className:t,...s}=this.props,l=(0,ce.default)({[C.btn]:!0,[C["btn--disabled"]]:!o,[C["btn--notAllowed"]]:!o,[C["btn--highlighted"]]:r,[t]:t&&t.length});return x.default.createElement("button",{className:l,...{disabled:!o},...s},this.props.children)}};b.propTypes={isEnabled:g.default.bool,isHighlighted:g.default.bool,className:g.default.string,label:g.default.string,children:g.default.node.isRequired,onClick:g.default.func.isRequired};var d={dropdownOptionCheckbox__input:"codeq-zYCUHW_dropdownOptionCheckbox__input",badge:"codeq-zYCUHW_badge","dropDown__item--disabled":"codeq-zYCUHW_dropDown__item--disabled","dropDown__item--isPublishing":"codeq-zYCUHW_dropDown__item--isPublishing",dropDown__item:"codeq-zYCUHW_dropDown__item","dropDown__item--canPublish":"codeq-zYCUHW_dropDown__item--canPublish",dropDown__contents:"codeq-zYCUHW_dropDown__contents",dropDown__btn:"codeq-zYCUHW_dropDown__btn",publishBtn:"codeq-zYCUHW_publishBtn",wrapper:"codeq-zYCUHW_wrapper","dropDown__item--noHover":"codeq-zYCUHW_dropDown__item--noHover",dropdownOptionCheckbox__label:"codeq-zYCUHW_dropdownOptionCheckbox__label",dropDown:"codeq-zYCUHW_dropDown",dropDown__iconWrapper:"codeq-zYCUHW_dropDown__iconWrapper",dropdownOptionCheckbox:"codeq-zYCUHW_dropdownOptionCheckbox","dropDown__item--isSaving":"codeq-zYCUHW_dropDown__item--isSaving","dropDown__item--isDiscarding":"codeq-zYCUHW_dropDown__item--isDiscarding"};var{publishableNodesSelector:ye,publishableNodesInDocumentSelector:ve,baseWorkspaceSelector:xe,isWorkspaceReadOnlySelector:We}=P.selectors.CR.Workspaces,f=class extends i.PureComponent{constructor(){super(...arguments);this.handlePublishAllClick=()=>{let{publishableNodes:r,publishAction:t,baseWorkspace:s}=this.props;t(r.map(l=>l?.contextPath),s)};this.handleDiscardClick=()=>{let{publishableNodesInDocument:r,discardAction:t}=this.props;t(r.map(s=>s?.contextPath))};this.handleDiscardAllClick=()=>{let{publishableNodes:r,discardAction:t}=this.props;t(r.map(s=>s?.contextPath))}}render(){let{publishableNodes:r,publishableNodesInDocument:t,isSaving:s,isPublishing:l,isDiscarding:c,isWorkspaceReadOnly:q,i18nRegistry:L}=this.props,be=!s&&!l&&!c&&t&&t.length>0,A=!s&&!l&&!c&&r&&r.length>0,fe=this.getTranslatedMainButton(),F=(0,ue.default)({[d.dropDown__btn]:!0,[d["dropDown__item--canPublish"]]:A,[d["dropDown__item--isPublishing"]]:l,[d["dropDown__item--isSaving"]]:s,[d["dropDown__item--isDiscarding"]]:c}),M=t?t.length:0,N=r?r.length:0;return i.default.createElement("div",{id:"neos-PublishDropDown",className:d.wrapper},i.default.createElement(b,{id:"neos-PublishDropDown-Publish",className:d.publishBtn,isEnabled:!q&&A,isHighlighted:A||s||l,onClick:this.handlePublishAllClick},fe," ",q?i.default.createElement(u.Icon,{icon:"lock"}):"",N>0&&i.default.createElement(u.Badge,{className:d.badge,label:String(N)})),i.default.createElement(u.DropDown,{className:d.dropDown},l||s||c?i.default.createElement(u.DropDown.Header,{iconIsOpen:"spinner",iconIsClosed:"spinner",iconRest:{spin:!0,transform:"up-8"},className:F,disabled:!0,"aria-label":L.translate("Neos.Neos:Main:showPublishOptions","Show publishing options")}):i.default.createElement(u.DropDown.Header,{className:F,"aria-label":L.translate("Neos.Neos:Main:showPublishOptions","Show publishing options")}),i.default.createElement(u.DropDown.Contents,{className:d.dropDown__contents},i.default.createElement("li",{className:d.dropDown__item},i.default.createElement(b,{id:"neos-PublishDropDown-Discard",isEnabled:be,isHighlighted:!1,label:"Discard",icon:"ban",onClick:this.handleDiscardClick},i.default.createElement("div",{className:d.dropDown__iconWrapper},i.default.createElement(u.Icon,{icon:"ban"})),i.default.createElement(_.default,{id:"Neos.Neos:Main:discard",fallback:"Discard"}),M>0&&i.default.createElement(u.Badge,{className:d.badge,label:String(M)}))),i.default.createElement("li",{className:d.dropDown__item},i.default.createElement(b,{id:"neos-PublishDropDown-DiscardAll",isEnabled:A,isHighlighted:!1,onClick:this.handleDiscardAllClick},i.default.createElement("div",{className:d.dropDown__iconWrapper},i.default.createElement(u.Icon,{icon:"ban"})),i.default.createElement(_.default,{id:"Neos.Neos:Main:discardAll",fallback:"Discard All"}),N>0&&i.default.createElement(u.Badge,{className:d.badge,label:String(N)}))))))}getTranslatedMainButton(){let{publishableNodes:r,isSaving:t,isPublishing:s,isDiscarding:l}=this.props,c=r&&r.length>0;return t?i.default.createElement(_.default,{id:"Neos.Neos:Main:saving",fallback:"saving"}):s?i.default.createElement(_.default,{id:"Neos.Neos:Main:publishTo",fallback:"Publish to",params:{0:"..."}}):l?"Discarding...":c?i.default.createElement(_.default,{id:"Neos.Neos:Main:publishAll",fallback:"Publish All"}):i.default.createElement(i.Fragment,null,i.default.createElement(_.default,{id:"Neos.Neos:Main:published",fallback:"Published"}))}};f.propTypes={isSaving:h.default.bool,isPublishing:h.default.bool,isDiscarding:h.default.bool,isWorkspaceReadOnly:h.default.bool,publishableNodes:h.default.array,publishableNodesInDocument:h.default.array,baseWorkspace:h.default.string.isRequired,publishAction:h.default.func.isRequired,discardAction:h.default.func.isRequired,i18nRegistry:h.default.object.isRequired},f=Y([(0,pe.connect)(e=>({isSaving:e?.ui?.remote?.isSaving,isPublishing:e?.ui?.remote?.isPublishing,isDiscarding:e?.ui?.remote?.isDiscarding,publishableNodes:ye(e),publishableNodesInDocument:ve(e),baseWorkspace:xe(e),isWorkspaceReadOnly:We(e)}),{publishAction:P.actions.CR.Workspaces.publish,discardAction:P.actions.CR.Workspaces.commenceDiscard}),(0,me.neos)(e=>({i18nRegistry:e.get("i18n")}))],f);var ke=({iframeUri:e})=>{let o=(0,W.useSelector)(ee.advancedPublishDialogOpen),r=D.useRef(null),t=(0,W.useDispatch)(),s=D.useCallback(()=>{r.current?.contentWindow&&window.addEventListener("message",c=>{c.data==="closePublicationPopup"&&t(S.toggleAdvancedPublishDialog({open:!1}))})},[]);return o?D.createElement("iframe",{ref:r,onLoad:s,style:{width:"100%",height:"100%",position:"absolute",zIndex:"999999",top:"0",background:"#000",border:"0"},src:e}):""};G("CodeQ.AdvancedPublish",{},(e,{frontendConfiguration:o})=>{if(!o["CodeQ.AdvancedPublish"].enabled)return;function*r(){yield(0,w.takeLatest)(U.actionTypes.CR.Workspaces.PUBLISH,function*(){let{payload:t}=yield(0,w.take)(U.actionTypes.ServerFeedback.HANDLE_SERVER_FEEDBACK);if(!t.feedbackEnvelope.feedbacks.some(s=>s.type==="Neos.Neos.Ui:Success")){console.warn("CodeQ.AdvancedPublish :: Publishing doesnt seem to have been successful. Aborting.");return}yield(0,w.put)(S.toggleAdvancedPublishDialog())})}e.get("containers").set("Modals/CodeQ.AdvancedPublish",()=>he.createPortal(D.createElement(ke,{iframeUri:o["CodeQ.AdvancedPublish"].iframeUri}),document.body)),e.get("sagas").set("CodeQ.AdvancedPublish/afterPublish",{saga:r}),e.get("reducers").set("CodeQ.AdvancedPublish",{reducer:Z}),e.get("containers").set("PrimaryToolbar/Right/PublishDropDown",f)});})();
//# sourceMappingURL=Plugin.js.map
